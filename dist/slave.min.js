!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("slave",[],e):"object"==typeof exports?exports.slave=e():(t.gravity=t.gravity||{},t.gravity.gateway=t.gravity.gateway||{},t.gravity.gateway.slave=e())}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=7)}([function(t,e){var n={debug:!1,out:function(){if(this.debug){var t=Array.prototype.slice.call(arguments),e=t.splice(0,1);console[e]?console[e].apply(this,t):console.log.apply(this,t)}}},i=function(t,e){var n=Date.now();return function(){n+e-Date.now()<0&&(t(),n=Date.now())}};t.exports={logger:n,throttle:i}},function(t,e,n){var i=n(0).logger,a={topics:{},subscribe:function(t,e){var n,a=this;return t&&"function"==typeof e?(this.topics[t]||(this.topics[t]=[]),n=this.topics[t].push(e)-1,{remove:function(){a.topics[t].splice(n,1)}}):(i.out("error","Subscribe failed - action property is invalid or missing."),!1)},once:function(t,e){var n=!1;return"function"==typeof e&&(n=this.subscribe(t,function(){e(),n.remove()})),n},unsubscribe:function(t){return this.topics[t]?(delete this.topics[t],!0):(i.out("error","Unsubscribe failed - topic "+t+" doesn´t exist"),!1)},publish:function(t,e){var n=this.findAction(t);if(!n)return i.out("error","Publish failed - topic "+t+" doesn´t exist"),!1;n.forEach(function(t){t(void 0!==e?e:{})})},clearSubscriptions:function(){this.topics={}},findAction:function(t){return this.topics.hasOwnProperty(t)?this.topics[t]:"*"!==t&&this.checkWildcardActions(t)},isSubscribed:function(t){return this.topics.hasOwnProperty(t)&&this.topics[t].length},checkWildcardActions:function(t){var e,n,i=t.split(".");if(i.pop(),i.length>0){n=i.join(".");for(var a in this.topics)if(e=new RegExp("^"+n+"\\.\\*$","g"),e.test(a))return this.topics[a];return this.checkWildcardActions(n)}return this.findAction("*")}};t.exports=a},function(t,e,n){function i(t,e,n){this.MODIFIER_KEYS={shiftKey:["Shift",16],ctrlKey:["Ctrl",17],altKey:["Alt",18,"AltGr",225],metaKey:["Meta",91]},this.config=t,this.eventCallback=e,this.eventName=n,this.addEventListeners()}var a=n(0).logger;i.prototype={addEventListeners:function(){for(var t in this.config)window.addEventListener(t,this.handleEvent.bind(this))},handleEvent:function(t){var e=t.type.toLowerCase();"click"===e?this.handleClickEvent(t):"scroll"===e?this.handleScrollEvent(t):"keyup"===e||"keydown"===e||"keypress"===e?this.handleKeyboardEvent(t):a.out("warning","Unable to dispatch event! Event "+e+" is not supported by gateway.")},handleScrollEvent:function(t){var e={action:this.eventName,event:t.type,top:window.document.body.scrollTop,left:window.document.body.scrollLeft,totalHeight:window.innerHeight,totalWidth:window.innerWidth};this.eventCallback(e)},handleClickEvent:function(t){var e={action:this.eventName,event:t.type};this.eventCallback(e)},handleKeyboardEvent:function(t){for(var e,n=t.which||t.keyCode,i=t.key||t.keyIdentifier,o=this.config[t.type],r=0;r<o.length;r++)if(e=String(o[r]),n=String(n),i=String(i),-1!==e.indexOf(n)||-1!==e.indexOf(i)){if(-1===e.indexOf("+"))return void this.keyboardEventCallback(t);var s=this.getModifierKey(e);if(s&&!0===t[s])return void this.keyboardEventCallback(t)}a.out("info","Key "+i+" is not marked for propagation.")},getModifierKey:function(t){for(var e in this.MODIFIER_KEYS)for(var n=this.MODIFIER_KEYS[e],i=0;i<n.length;i++)if(-1!==t.indexOf(n[i]))return e},keyboardEventCallback:function(t){var e={action:this.eventName,event:t.type,key:t.key||t.keyIdentifier,keyCode:t.which||t.keyCode,keyboardButton:t.code||null,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,ctrlKey:t.ctrlKey};this.eventCallback(e)}},t.exports=function(t,e,n){return t?new i(t,e,n):(a.out("info","No key bindings passed."),!1)}},,,,,function(t,e,n){t.exports=n(8)},function(t,e,n){function i(t){if(!t)return!1;var e=t.slaveId||t.productId;return e&&"string"==typeof e?(s.out("info","[GG] Slave."+e+":","Initializing"),!0):(s.out("error","[GG] Slave:","slaveId/productId property is invalid or missing"),!1)}var a=n(9),o=n(1),r=n(10),s=n(0).logger,d=n(2),l=n(11),c={slaveId:"",config:null,initialized:!1,load:null,msgSender:"Slave",init:function(t){this.initialized=!0,this.config=t,this.slaveId=t.slaveId||t.productId,this.load=t.load||null,this.setAllowedDomains(),window.addEventListener("message",this.handleMessage.bind(this)),this.config.eventPropagation&&d(this.config.eventPropagation,this.sendMessage.bind(this),"Slave.Event"),this.config.worker&&this.setWorker(),this.startSlaveInitialization()},setAllowedDomains:function(){this.config&&this.config.allowedOrigins?this.allowedOrigins=this.config.allowedOrigins:this.allowedOrigins="*"},startSlaveInitialization:function(){this.sendMessage({action:"Slave.Init",data:this.config.data,eventPropagation:this.config.eventPropagation,eventListeners:this.config.eventListeners})},handleMessage:function(t){if(!t.data.msgSender||t.data.msgSender===this.msgSender)return!1;var e,n;return"*"!==this.allowedOrigins&&-1===this.allowedOrigins.indexOf(t.origin)?(s.out("error","[GG] Slave."+this.slaveId+": Message origin is not allowed"),!1):(e=new RegExp("^Slave\\.","g"),n=new RegExp("^Master\\.","g"),e.test(t.data.action)||n.test(t.data.action)?(this.handleProtectedMessage(t),!1):(s.out("info","[GG] Slave."+this.slaveId+": Master message received:",t.data),void o.publish(t.data.action,t.data)))},handleProtectedMessage:function(t){var e=t.data.action.replace(".","");e=e.charAt(0).toLowerCase()+e.slice(1),this[e]?this[e](t):s.out("warn","[GG] Slave."+this.slaveId+":","Actions with domain `Master` or `Slave` are protected!")},setWorker:function(){var t=["Slave.Resize"],e=l.setMsgProxy(this.config.worker,{debug:this.config.debug},o.publish.bind(o),this.sendMessage.bind(this));if(!e)return s.out("error","[GG] Slave."+this.slaveId+":","Web worker initialization failed. Provide instance of Worker or path to file"),!1;s.out("info","[GG] Slave."+this.slaveId+":","Web worker initialized."),a.setWorker(e,t)},slaveLoad:function(t){s.out("info","[GG] Slave."+this.slaveId+":","Starting to load.",t.data),t.data.autoResize&&r.init(this.sendMessage.bind(this),"Slave.Resize"),this.load&&this.load(t.data)},slaveShown:function(t){s.out("info","[GG] Slave:","Slave.Shown event received.",t.data),o.publish(t.data.action,t.data)},masterEvent:function(t){s.out("info","[GG] Slave."+this.slaveId+":","Publish Master.Event event.",t.data),o.publish(t.data.action,t.data)},subscribe:function(t,e){return o.subscribe(t,e)},unsubscribe:function(t){return o.unsubscribe(t)},clearSubscriptions:function(){return o.clearSubscriptions()},sendMessage:function(t,e){t.slaveId=this.slaveId,t.msgSender="Slave",a.sendMessage(t,e)}};t.exports=function(t){return t&&!0===t.debug&&(s.debug=!0),!c.initialized&&i(t)?(c.init(t),c):!!c.initialized&&c}},function(t,e){function n(){this.worker=null,this.msgBlacklist=null}n.prototype={setWorker:function(t,e){this.worker=t,this.msgBlacklist=e},sendMessage:function(t,e){var n=e||"*";window.parent.postMessage(t,n),this.worker&&-1===this.msgBlacklist.indexOf(t.action)&&this.worker.postMessage(t)}},t.exports=new n},function(t,e){var n=[{type:"Animation Start",eventName:["animationstart","webkitAnimationStart"]},{type:"Animation Iteration",eventName:["animationiteration","webkitAnimationIteration"]},{type:"Animation End",eventName:["animationend","webkitAnimationEnd"]},{type:"Input",eventName:"input"},{type:"Resize",eventName:"resize"},{type:"Click",eventName:"click"},{type:"Orientation Change",eventName:"orientationchange"},{type:"Print",eventName:["afterprint","beforeprint"]},{type:"Ready State Change",eventName:"readystatechange"},{type:"Touch Start",eventName:"touchstart"},{type:"Touch End",eventName:"touchend"},{type:"Touch Cancel",eventName:"touchcancel"},{type:"Transition Start",eventName:["transitionstart","webkitTransitionStart","MSTransitionStart","oTransitionStart","otransitionstart"]},{type:"Transition Iteration",eventName:["transitioniteration","webkitTransitionIteration","MSTransitionIteration","oTransitionIteration","otransitioniteration"]},{type:"Transition End",eventName:["transitionend","webkitTransitionEnd","MSTransitionEnd","oTransitionEnd","otransitionend"]}],i={eventName:null,DOMReady:!1,intervalTimer:null,currentWidth:0,currentHeight:0,init:function(t,e){this.eventCallback=t,this.eventName=e,this.addContentListeners(),this.listenDOMReady(),window.MutationObserver||window.WebKitMutationObserver?this.setupMutationObserver():this.runDirtyCheck()},handleContentChange:function(){if(!this.DOMReady)return!1;var t,e=window.innerWidth,n=this.getContentHeight()+this.getElementOffset(document.body);e===this.currentWidth&&n===this.currentHeight||(this.currentWidth=e,this.currentHeight=n,t={action:this.eventName,width:e,height:n},this.eventCallback(t))},getContentHeight:function(){var t=0,e=document.querySelectorAll("body > *");return e.length?(Array.prototype.forEach.call(e,function(e){t+=e.offsetHeight+this.getElementOffset(e)}.bind(this)),t):0},getElementOffset:function(t){var e=getComputedStyle(t),n=0;return n+=parseInt(e.getPropertyValue("margin-top")),n+=parseInt(e.getPropertyValue("margin-bottom")),n+=parseInt(e.getPropertyValue("padding-top")),n+=parseInt(e.getPropertyValue("padding-bottom"))},listenDOMReady:function(){var t=this,e=window.setInterval(function(){"loading"!==window.document.readyState&&(clearInterval(e),t.DOMReady=!0,t.handleContentChange())},5)},addContentListeners:function(){n.forEach(function(t){Array.isArray(t.eventName)?t.eventName.forEach(function(t){window.addEventListener(t,this.handleContentChange.bind(this))}.bind(this)):window.addEventListener(t.eventName,this.handleContentChange.bind(this))}.bind(this))},setupMutationObserver:function(){var t,e=window.MutationObserver||window.WebKitMutationObserver,n={childList:!0,subtree:!0,characterData:!0,attributes:!0},i=document.querySelector("body");t=new e(this.handleContentChange.bind(this)),t.observe(i,n)},runDirtyCheck:function(){this.intervalTimer=setInterval(function(){this.handleContentChange()}.bind(this),200)}};t.exports=i},function(t,e,n){var i=n(0).logger,a={worker:null,plugins:null,publish:null,sendMsg:null,setMsgProxy:function(t,e,n,a){if(t.src instanceof Worker)this.worker=t.src;else{if("string"!=typeof t.src)return!1;this.worker=new Worker(t.src)}return i.debug=e.debug||!1,this.publish=n,this.sendMessage=a,t.plugins&&(this.plugins=t.plugins,this.plugins.forEach(function(t){t.setConfig(e)})),this.worker.addEventListener("message",this.handleProxyMsg.bind(this)),this.worker},handleProxyMsg:function(t){if(!t.data.action)return i.out("error","[GG] Worker message is missing an action name =>",t.data),!1;var e=new RegExp("^Plugin\\.","g"),n=e.test(t.data.action);"Slave.Loaded"===t.data.action?this.slaveLoaded(t):n?this.pluginMsg(t):this.publishMsg(t)},slaveLoaded:function(t){i.out("info","[GG] Slave redirecting message from worker to master =>",t.data),this.sendMsg({action:"Slave.Loaded",data:t.data.data})},pluginMsg:function(t){i.out("info","[GG] Slave redirecting message from worker to plugin =>",t.data);var e=this;this.plugins.forEach(function(n){var i=n.handleMessage(t);e.worker.postMessage({action:t.data.action,data:i})})},publishMsg:function(t){i.out("info","[GG] Slave redirecting message from worker to slave =>",t.data),this.publish(t.data.action,t.data)}};t.exports=a}])});