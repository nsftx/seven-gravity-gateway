!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("index",[],t):"object"==typeof exports?exports.index=t():(e.gravity=e.gravity||{},e.gravity.gateway=e.gravity.gateway||{},e.gravity.gateway.index=t())}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=12)}([function(e,t){var n={debug:!1,out:function(){if(this.debug){var e=Array.prototype.slice.call(arguments),t=e.splice(0,1);console[t]?console[t].apply(this,e):console.log.apply(this,e)}}},i=function(e,t){var n=Date.now();return function(){n+t-Date.now()<0&&(e(),n=Date.now())}},a=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})};e.exports={logger:n,throttle:i,uuidv4:a}},function(e,t,n){var i=n(0).logger,a={topics:{},subscribe:function(e,t){var n,a=this;return e&&"function"==typeof t?(this.topics[e]||(this.topics[e]=[]),n=this.topics[e].push(t)-1,{remove:function(){a.topics[e].splice(n,1)}}):(i.out("error","Subscribe failed - action property is invalid or missing."),!1)},once:function(e,t){var n=!1;return"function"==typeof t&&(n=this.subscribe(e,function(){t(),n.remove()})),n},unsubscribe:function(e){return this.topics[e]?(delete this.topics[e],!0):(i.out("error","Unsubscribe failed - topic "+e+" doesn´t exist"),!1)},publish:function(e,t){var n=this.findAction(e);if(!n)return i.out("error","Publish failed - topic "+e+" doesn´t exist"),!1;n.forEach(function(e){e(void 0!==t?t:{})})},clearSubscriptions:function(){this.topics={}},findAction:function(e){return this.topics.hasOwnProperty(e)?this.topics[e]:"*"!==e&&this.checkWildcardActions(e)},isSubscribed:function(e){return this.topics.hasOwnProperty(e)&&this.topics[e].length},checkWildcardActions:function(e){var t,n,i=e.split(".");if(i.pop(),i.length>0){n=i.join(".");for(var a in this.topics)if(t=new RegExp("^"+n+"\\.\\*$","g"),t.test(a))return this.topics[a];return this.checkWildcardActions(n)}return this.findAction("*")}};a.on=a.subscribe,a.off=a.unsubscribe,e.exports=a},function(e,t,n){function i(e,t,n){this.MODIFIER_KEYS={shiftKey:["Shift",16],ctrlKey:["Ctrl",17],altKey:["Alt",18,"AltGr",225],metaKey:["Meta",91]},this.config=e,this.eventCallback=t,this.eventName=n,this.addEventListeners()}var a=n(0).logger;i.prototype={addEventListeners:function(){for(var e in this.config)window.addEventListener(e,this.handleEvent.bind(this))},handleEvent:function(e){var t=e.type.toLowerCase();"click"===t?this.handleClickEvent(e):"scroll"===t?this.handleScrollEvent(e):"keyup"===t||"keydown"===t||"keypress"===t?this.handleKeyboardEvent(e):a.out("warning","Unable to dispatch event! Event "+t+" is not supported by gateway.")},handleScrollEvent:function(e){var t={action:this.eventName,event:e.type,top:window.document.body.scrollTop,left:window.document.body.scrollLeft,totalHeight:window.innerHeight,totalWidth:window.innerWidth};this.eventCallback(t)},handleClickEvent:function(e){var t={action:this.eventName,event:e.type};this.eventCallback(t)},handleKeyboardEvent:function(e){for(var t,n=e.which||e.keyCode,i=e.key||e.keyIdentifier,s=this.config[e.type],o=0;o<s.length;o++)if(t=String(s[o]),n=String(n),i=String(i),-1!==t.indexOf(n)||-1!==t.indexOf(i)){if(-1===t.indexOf("+"))return void this.keyboardEventCallback(e);var r=this.getModifierKey(t);if(r&&!0===e[r])return void this.keyboardEventCallback(e)}a.out("info","Key "+i+" is not marked for propagation.")},getModifierKey:function(e){for(var t in this.MODIFIER_KEYS)for(var n=this.MODIFIER_KEYS[t],i=0;i<n.length;i++)if(-1!==e.indexOf(n[i]))return t},keyboardEventCallback:function(e){var t={action:this.eventName,event:e.type,key:e.key||e.keyIdentifier,keyCode:e.which||e.keyCode,keyboardButton:e.code||null,shiftKey:e.shiftKey,altKey:e.altKey,metaKey:e.metaKey,ctrlKey:e.ctrlKey};this.eventCallback(t)}},e.exports=function(e,t,n){return e?new i(e,t,n):(a.out("info","No key bindings passed."),!1)}},function(e,t,n){e.exports=n(4)},function(e,t,n){function i(e){var t=!0;for(var n in e)e[n].frameId&&"string"==typeof e[n].frameId||(d.out("error","[GG] Master:","frameId property is invalid or missing for "+n),t=!1);return t}function a(e){if(!e)return!1;var t=e.slaves||e.products;return t&&"object"==typeof t||d.out("warn","[GG] Master:","slaves/products object is invalid or missing"),!!(!t||i(t))&&(d.out("info","[GG] Master:","Initializing"),!0)}var s=n(5),o=n(1),r=n(6),d=n(0).logger,c=n(0).uuidv4,u=n(2),l={initialized:!1,slaves:{},config:null,allowedOrigins:null,msgSender:"Master",init:function(e){var t=e.slaves||e.products;this.initialized=!0,this.config=e,this.slaves=t||{},this.setAllowedDomains(),window.addEventListener("message",this.handleMessage.bind(this))},addSlave:function(e){var t=e.slaveId||e.productId;return t&&"string"==typeof t?e.frameId&&"string"==typeof e.frameId?(delete e.slaveId,void(this.slaves[t]=e)):(d.out("error","[GG] Master:","frameId property is invalid or missing for "+e),!1):(d.out("error","[GG] Master:","slaveId/productId property is invalid or missing for "+e),!1)},removeSlave:function(e){if(!e||!this.slaves[e])return d.out("error","[GG] Master:","Passed slaveId is invalid or it doesn`t exist."),!1;delete this.slaves[e],d.out("info","[GG] Master:","slave: "+e+" succesfully removed.")},setAllowedDomains:function(){this.config&&this.config.allowedOrigins?this.allowedOrigins=this.config.allowedOrigins:this.allowedOrigins="*"},handleMessage:function(e){if(!e.data.msgSender||e.data.msgSender===this.msgSender)return d.out("warn","[GG] Master: Event data missing sender info.",e),!1;var t,n;return"*"!==this.allowedOrigins&&-1===this.allowedOrigins.indexOf(e.origin)?(d.out("error","[GG] Master: Message origin is not allowed"),!1):(t=new RegExp("^Master\\.","g"),n=new RegExp("^Slave\\.","g"),n.test(e.data.action)||t.test(e.data.action)?(this.handleProtectedMessage(e),!1):(d.out("info","[GG] Master: Slave message received:",e.data),void o.publish(e.data.action,e.data)))},handleProtectedMessage:function(e){var t=e.data.slaveId||e.data.productId;if(!this.slaves[t])return!1;var n=this.slaves[t],i=e.data.action.replace(".","");i=i.charAt(0).toLowerCase()+i.slice(1),this[i]?this[i](e,n):d.out("warn","[GG] Master:","Actions with domain `Master` or `Slave` are protected!")},slaveInit:function(e,t){d.out("info","[GG] Master:","Starting to load slave.",e.data),void 0!==t.autoResize&&!1===t.autoResize||r.resetFrameSize(t.frameId),t.init&&t.init(e.data),e.data.eventListeners&&u(e.data.eventListeners,this.sendMessage.bind(this,t.frameId),"Master.Event"),this.slaveLoad(t)},slaveLoad:function(e){this.sendMessage(e.frameId,{action:"Slave.Load",data:"function"==typeof e.data?e.data():e.data||{},autoResize:void 0===e.autoResize||e.autoResize})},slaveResize:function(e,t){d.out("info","[GG] Master:","Resizing slave.",e.data),r.resize(t.frameId,e)},slaveLoaded:function(e,t){if(!t.loaded)return!1;d.out("info","[GG] Master:","Slave loaded.",e.data),t.loaded(e.data)},slaveEvent:function(e){d.out("info","[GG] Master:","Slave.Event event received.",e.data),o.publish(e.data.action,e.data)},once:function(e,t){return o.once(e,t)},subscribe:function(e,t){return o.subscribe(e,t)},unsubscribe:function(e){return o.unsubscribe(e)},clearSubscriptions:function(){return o.clearSubscriptions()},sendMessage:function(e,t,n){var i=document.getElementById(e);if(!i)return d.out("warn","[GG] Master:","Frame "+e+" is non existent."),!1;t.msgSender=this.msgSender,s.sendMessage(i,t,n)},sendMessageAsync:function(e,t,n,i){var a,s=this,o=null;return i=i||0,new Promise(function(r,u){t.asyncId=t.action+"_"+c(),a=s.once(t.asyncId,function(e){d.out("info","[GG] Master: Promise resolved for event "+t.action,e),clearTimeout(o),o=null,r(e)}),i&&(o=setTimeout(function(){d.out("info","[GG] Master: Promise rejected for event "+t.action),a.remove(),u()},i)),s.sendMessage(e,t,n)})}};l.on=l.subscribe,l.off=l.unsubscribe,l.emit=l.sendMessage,l.emitAsync=l.sendMessageAsync,e.exports=function(e){return e&&!0===e.debug&&(d.debug=!0),!l.initialized&&a(e)?(l.init(e),l):!!l.initialized&&l}},function(e,t){function n(){}n.prototype={sendMessage:function(e,t,n){var i=e.contentWindow||window,a=n||"*";i.postMessage(t,a)}},e.exports=new n},function(e,t){var n={resetFrameSize:function(e){requestAnimationFrame(function(){var t=document.getElementById(e);t&&(t.style.height=event.data.height+"px")})},resize:function(e,t){requestAnimationFrame(function(){var n=document.getElementById(e);n&&(n.style.height=t.data.height+"px")})}};e.exports=n},function(e,t,n){e.exports=n(8)},function(e,t,n){function i(e){if(!e)return!1;var t=e.slaveId||e.productId;return t&&"string"==typeof t?(r.out("info","[GG] Slave."+t+":","Initializing"),!0):(r.out("error","[GG] Slave:","slaveId/productId property is invalid or missing"),!1)}var a=n(9),s=n(1),o=n(10),r=n(0).logger,d=n(2),c=n(0).uuidv4,u=n(11),l={slaveId:"",config:null,initialized:!1,load:null,msgSender:"Slave",init:function(e){this.initialized=!0,this.config=e,this.slaveId=e.slaveId||e.productId,this.load=e.load||null,this.setAllowedDomains(),window.addEventListener("message",this.handleMessage.bind(this)),this.config.eventPropagation&&d(this.config.eventPropagation,this.sendMessage.bind(this),"Slave.Event"),this.config.worker&&this.setWorker(),this.startSlaveInitialization()},setAllowedDomains:function(){this.config&&this.config.allowedOrigins?this.allowedOrigins=this.config.allowedOrigins:this.allowedOrigins="*"},startSlaveInitialization:function(){this.sendMessage({action:"Slave.Init",data:this.config.data,eventPropagation:this.config.eventPropagation,eventListeners:this.config.eventListeners})},handleMessage:function(e){if(!e.data.msgSender||e.data.msgSender===this.msgSender)return r.out("warn","[GG] Slave."+this.slaveId+": Event data missing sender info.",e),!1;var t,n;return"*"!==this.allowedOrigins&&-1===this.allowedOrigins.indexOf(e.origin)?(r.out("error","[GG] Slave."+this.slaveId+": Message origin is not allowed"),!1):(t=new RegExp("^Slave\\.","g"),n=new RegExp("^Master\\.","g"),t.test(e.data.action)||n.test(e.data.action)?(this.handleProtectedMessage(e),!1):(r.out("info","[GG] Slave."+this.slaveId+": Master message received:",e.data),void s.publish(e.data.action,e.data)))},handleProtectedMessage:function(e){var t=e.data.action.replace(".","");t=t.charAt(0).toLowerCase()+t.slice(1),this[t]?this[t](e):r.out("warn","[GG] Slave."+this.slaveId+":","Actions with domain `Master` or `Slave` are protected!")},setWorker:function(){var e=["Slave.Resize"],t=u.setMsgProxy(this.config.worker,{debug:this.config.debug},s.publish.bind(s),this.sendMessage.bind(this));if(!t)return r.out("error","[GG] Slave."+this.slaveId+":","Web worker initialization failed. Provide instance of Worker or path to file"),!1;r.out("info","[GG] Slave."+this.slaveId+":","Web worker initialized."),a.setWorker(t,e)},slaveLoad:function(e){r.out("info","[GG] Slave."+this.slaveId+":","Starting to load.",e.data),e.data.autoResize&&o.init(this.sendMessage.bind(this),"Slave.Resize"),this.load&&this.load(e.data)},slaveShown:function(e){r.out("info","[GG] Slave:","Slave.Shown event received.",e.data),s.publish(e.data.action,e.data)},masterEvent:function(e){r.out("info","[GG] Slave."+this.slaveId+":","Publish Master.Event event.",e.data),s.publish(e.data.action,e.data)},once:function(e,t){return s.once(e,t)},subscribe:function(e,t){return s.subscribe(e,t)},unsubscribe:function(e){return s.unsubscribe(e)},clearSubscriptions:function(){return s.clearSubscriptions()},sendMessage:function(e,t){e.slaveId=this.slaveId,e.msgSender="Slave",a.sendMessage(e,t)},sendMessageAsync:function(e,t,n){var i,a=this,s=null;return n=n||0,new Promise(function(o,d){e.asyncId=e.action+"_"+c(),i=a.once(e.asyncId,function(){r.out("info","[GG] Slave."+a.slaveId+"Promise resolved for event "+e.action),clearTimeout(s),s=null,o()}),n&&(s=setTimeout(function(){r.out("info","[GG] Slave."+a.slaveId+"Promise rejected for event "+e.action),i.remove(),d()},n)),a.sendMessage(e,t)})}};l.on=l.subscribe,l.off=l.unsubscribe,l.emit=l.sendMessage,l.emitAsync=l.sendMessageAsync,e.exports=function(e){return e&&!0===e.debug&&(r.debug=!0),!l.initialized&&i(e)?(l.init(e),l):!!l.initialized&&l}},function(e,t){function n(){this.worker=null,this.msgBlacklist=null}n.prototype={setWorker:function(e,t){this.worker=e,this.msgBlacklist=t},sendMessage:function(e,t){var n=t||"*";window.parent.postMessage(e,n),this.worker&&-1===this.msgBlacklist.indexOf(e.action)&&this.worker.postMessage(e)}},e.exports=new n},function(e,t){var n=[{type:"Animation Start",eventName:["animationstart","webkitAnimationStart"]},{type:"Animation Iteration",eventName:["animationiteration","webkitAnimationIteration"]},{type:"Animation End",eventName:["animationend","webkitAnimationEnd"]},{type:"Input",eventName:"input"},{type:"Click",eventName:"click"},{type:"Orientation Change",eventName:"orientationchange"},{type:"Print",eventName:["afterprint","beforeprint"]},{type:"Ready State Change",eventName:"readystatechange"},{type:"Touch Start",eventName:"touchstart"},{type:"Touch End",eventName:"touchend"},{type:"Touch Cancel",eventName:"touchcancel"},{type:"Transition Start",eventName:["transitionstart","webkitTransitionStart","MSTransitionStart","oTransitionStart","otransitionstart"]},{type:"Transition Iteration",eventName:["transitioniteration","webkitTransitionIteration","MSTransitionIteration","oTransitionIteration","otransitioniteration"]},{type:"Transition End",eventName:["transitionend","webkitTransitionEnd","MSTransitionEnd","oTransitionEnd","otransitionend"]}],i={eventName:null,DOMReady:!1,intervalTimer:null,currentWidth:0,currentHeight:0,init:function(e,t){this.eventCallback=e,this.eventName=t,this.addContentListeners(),this.listenDOMReady(),window.MutationObserver||window.WebKitMutationObserver?this.setupMutationObserver():this.runDirtyCheck()},handleContentChange:function(){if(!this.DOMReady)return!1;var e,t=window.innerWidth,n=this.getContentHeight()+this.getElementOffset(document.body);t===this.currentWidth&&n===this.currentHeight||(this.currentWidth=t,this.currentHeight=n,e={action:this.eventName,width:t,height:n},this.eventCallback(e))},getContentHeight:function(){var e=0,t=document.querySelectorAll("body > *");return t.length?(Array.prototype.forEach.call(t,function(t){e+=t.offsetHeight+this.getElementOffset(t)}.bind(this)),e):0},getElementOffset:function(e){var t=getComputedStyle(e),n=0;return n+=parseInt(t.getPropertyValue("margin-top")),n+=parseInt(t.getPropertyValue("margin-bottom")),n+=parseInt(t.getPropertyValue("padding-top")),n+=parseInt(t.getPropertyValue("padding-bottom"))},listenDOMReady:function(){var e=this,t=window.setInterval(function(){"loading"!==window.document.readyState&&(clearInterval(t),e.DOMReady=!0,e.handleContentChange())},5)},addContentListeners:function(){n.forEach(function(e){Array.isArray(e.eventName)?e.eventName.forEach(function(e){window.addEventListener(e,this.handleContentChange.bind(this))}.bind(this)):window.addEventListener(e.eventName,this.handleContentChange.bind(this))}.bind(this))},setupMutationObserver:function(){var e,t=window.MutationObserver||window.WebKitMutationObserver,n={childList:!0,subtree:!0,characterData:!0,attributes:!0},i=document.querySelector("body");e=new t(this.handleContentChange.bind(this)),e.observe(i,n)},runDirtyCheck:function(){this.intervalTimer=setInterval(function(){this.handleContentChange()}.bind(this),200)}};e.exports=i},function(e,t,n){var i=n(0).logger,a={worker:null,plugins:null,publish:null,sendMsg:null,setMsgProxy:function(e,t,n,a){if(e.src instanceof Worker)this.worker=e.src;else{if("string"!=typeof e.src)return!1;this.worker=new Worker(e.src)}return i.debug=t.debug||!1,this.publish=n,this.sendMessage=a,e.plugins&&(this.plugins=e.plugins,this.plugins.forEach(function(e){e.setConfig(t)})),this.worker.addEventListener("message",this.handleProxyMsg.bind(this)),this.worker},handleProxyMsg:function(e){if(!e.data.action)return i.out("error","[GG] Worker message is missing an action name =>",e.data),!1;var t=new RegExp("^Plugin\\.","g"),n=t.test(e.data.action);"Slave.Loaded"===e.data.action?this.slaveLoaded(e):n?this.pluginMsg(e):this.publishMsg(e)},slaveLoaded:function(e){i.out("info","[GG] Slave redirecting message from worker to master =>",e.data),this.sendMsg({action:"Slave.Loaded",data:e.data.data})},pluginMsg:function(e){i.out("info","[GG] Slave redirecting message from worker to plugin =>",e.data);var t=this;this.plugins.forEach(function(n){var i=n.handleMessage(e);t.worker.postMessage({action:e.data.action,data:i})})},publishMsg:function(e){i.out("info","[GG] Slave redirecting message from worker to slave =>",e.data),this.publish(e.data.action,e.data)}};e.exports=a},function(e,t,n){e.exports={master:n(3),slave:n(7)}}])});